asyncapi: 2.6.0
info:
  title: Virgin Airlines Flight Change Events
  version: 1.0.0
  description: >
    Events produced when Flight Ops changes flight details (e.g., boarding gate).
    One event is produced per affected passenger booking.

servers:
  confluentKafka:
    url: pkc-xxxxx.australia-southeast1.gcp.confluent.cloud:9092
    protocol: kafka
    description: Confluent Kafka (example placeholder)

defaultContentType: application/json

channels:
  virgin.flight.changed.v1:
    description: >
      Published when a flight changes. One message per affected passenger.
    publish:
      operationId: publishFlightChanged
      summary: Flight Ops change propagated to passengers (per passenger)
      message:
        $ref: '#/components/messages/FlightChangedEvent'
    subscribe:
      operationId: subscribeFlightChanged
      summary: Consumers receive flight change events to notify passengers
      message:
        $ref: '#/components/messages/FlightChangedEvent'

components:
  messages:
    FlightChangedEvent:
      name: FlightChangedEvent
      title: Flight Changed Event (Per Passenger)
      contentType: application/json
      payload:
        $ref: '#/components/schemas/FlightChangedEventPayload'
      examples:
        - name: boardingGateChange
          payload:
            eventId: "9d1e3a4f-9b33-4b2d-8f7c-49b2c7a6f115"
            eventType: "flight.changed"
            occurredAt: "2026-01-21T06:12:11Z"
            correlationId: "c9d7b2d0-0bfb-49f0-9d2d-9e88f6f72e24"
            sourceSystem: "flight-ops"
            passenger:
              passengerId: "6e6e6cf1-9e50-4a4e-9d8b-3aa8b4c4e3a1"
              bookingPnr: "AB12CD"
              lastName: "Nightingale"
            flight:
              flightId: "2f3d2e21-9b6f-4a8a-88d2-24d8704fe2b0"
              flightNumber: "VA801"
              origin: "MEL"
              destination: "SYD"
              departureTime: "2026-01-21T09:15:00+11:00"
            change:
              field: "boardingGate"
              oldValue: "12"
              newValue: "14"
              reason: "Gate reallocated due to operational constraints"

  schemas:
    FlightChangedEventPayload:
      type: object
      required:
        - eventId
        - eventType
        - occurredAt
        - correlationId
        - sourceSystem
        - passenger
        - flight
        - change
      properties:
        eventId:
          type: string
          format: uuid
        eventType:
          type: string
          enum: [flight.changed]
        occurredAt:
          type: string
          format: date-time
        correlationId:
          type: string
          description: Correlation ID for tracing across API + integration + events
        sourceSystem:
          type: string
          example: flight-ops
        passenger:
          type: object
          required: [passengerId, bookingPnr, lastName]
          properties:
            passengerId:
              type: string
              format: uuid
            bookingPnr:
              type: string
              minLength: 6
              maxLength: 6
            lastName:
              type: string
        flight:
          type: object
          required: [flightId, flightNumber, origin, destination, departureTime]
          properties:
            flightId:
              type: string
              format: uuid
            flightNumber:
              type: string
            origin:
              type: string
              minLength: 3
              maxLength: 3
            destination:
              type: string
              minLength: 3
              maxLength: 3
            departureTime:
              type: string
              format: date-time
        change:
          type: object
          required: [field, oldValue, newValue]
          properties:
            field:
              type: string
              example: boardingGate
            oldValue:
              type: string
              nullable: true
            newValue:
              type: string
            reason:
              type: string
              nullable: true
